%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Introduction
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Introduction}
\label{cha1}
% 5-8 pages
% Some general information on the context and setting.
Optical Character Recognition (OCR) has been the topic of research for many decades. 
Several workshops, papers and journals have been published, conferences hold on issues in this field. %irrelevant, ferner keine Quellen angegeben. Wuerde eher so heranfuehren, dass es ein 'active field of study' ist
%While there are still many open problems (for instance the accurate recognition of arabic texts, symbols, mathematic formulas or handwriting), the knowledge in this area has already led to the development of several highly accurate systems (especially based on English text).
Recent result have already spawned/created some highly accurate systems, especially based on English text. Currently research focus is gradually shifting towards the recognition of non-latin alphabets and scalable approaches at OCR. %TODO:Hier ggf. noch nachlegen mit 'this thesis presents one such scalable approach ...'

%While already a lot of companies use those systems, there is still a majority of others that do not. But, as these systems grow more accurate each year, it is very likely that the need for ocr systems will grow. \par
While some companies are already using ORC as a means of process optimization, others have left its potential untapped. With more and more research towards scalable approaches the demand for ORC systems is likely to grow in the future [TODO:citation needed!].

As companies are getting connected and globalized, more and more data has to be handled. Modern keywords such as 'Big Data' or 'Data Mining' show, that there is currently a need for solutions to process those information.

One are that offers increased optimization potential is invoice management. Companies all over the world have to manage not only the invoices they generate, but also the ones they retrieve, e.g. from their suppliers.
Although ERP-systems capable of invoice generation already exist, they often represent specialized solutions that are not capable of handling foreign invoices. In addition to that, especially small but also medium-sized companies are mostly not able to afford such systems. 
% While there are already ERP-systems such as SAP ERP 6.0 that are capable of the generation of invoices, especially invoices of other companies are not that easy to process due to the differences between those documents. In addition to that, especially small but also medium-sized companies are mostly not able to afford such systems. 

In order to facilitate and accelerate the process of invoice recognition electronic invoice formats have been introduced. If invoices are sent in such a format, a company is recognize the required fields and handle this invoice. Again, this is often the case for big companies, that have defined contracts with their suppliers or customers and have therefore been able to define an electronic invoicing format to automatically process an invoice.

For every other company, the problems persist: Not every invoice is sent in an electronic format, some are still sent as a normal pdf document or even postal.

\section{Motivation}
\label{sec1.2}
%Specific motivation for the problem at hand.

At the moment, invoices exist that do not meet any electronic invoicing standard. Due to the efforts made in regards to digitalization and standardization, it is to be expected that such formats will be a future standard for all invoices to be sent. But, although a variety of possible formats have already been defined electronic invoice still lacks one central standardized format.
%But even though electronic invoice formats have already been introduced, there are still a variety of formats and no real standard defined. 
Therefore, depending on the country or area, different formats are used. To address this issue inside the European Union, the E-Invoicing Forum of Germany (FeRD) developed a new format which will be very likely a new de-facto standard for companies inside the European Union. Small and medium sized companies can make use of this format as well as bigger companies. Chapter 2 will explain the different levels of the format more deeply.

While hardware parts and devices improve over time, we are now at a point were even household computers (also known as personal computers) are able to process complex calculations in lesser time. With this in mind, it would be a profit to automate invoice processing, even for small companies. Invoices that are processed manually do not only need employees, but also much more time and are (due to the human factor) error-prone. 

With the use of machine learning techniques it should be possible to develop an application that works on a personal computer, can handle lots of invoices and transforms them into an electronic invoice format.

\section{Task}
\label{sec1.3}

The task of this master thesis is to develop an application which can handle various invoices that are present in PDF format, extract necessary invoice information and transform and store those invoices enriched by the electronic invoice format. The advantages and disadvantages of this format should be evaluated first.
During the processing of the invoice, optical character recognition should be used to extract the information from the file. This process is supported by Machine Learning to provide additional analytical benefits.
Error-handling during the scan process is a task of the application.
The stored invoices should be retrievable again, enhanced and conform with the electronic invoice format, so that it is possible to process them further.

\section{Related Work}
\label{sec1.4}
This section will present other work and concepts that have been presented before and distinguish between their solution and the method used in this thesis. In addition to that, we will explain reasons why the presented approach has not been suitable for our solution.

\subsection{Case-based-reasoning on invoice documents}
The process of information extraction on invoice documents has been topic of research for many years. One approach using Case-based-reasoning (CBR) has been published by Hamza et. al. \cite{hamza07}. They present a two iterative step that first tries to classify the invoice document as a whole (global-solving) and later repeats the classification on a keyword and pattern structure level (local solving). A Keyword in this approach are invoice specific words, such as the invoice date or invoice number. Pattern structures are words that appear in tables. An invoice always has to list every single position, thus the preferred way to do this is using a table in a document.
The case-based reasoning approach is an iterative approach that stores information if a pattern structure has been found on the same line or the same column and if the relevant data is present before (over) or after (under) the keyword. This way cases are stored in a database and reused everytime a new invoice has to be classified. The global solving resulted in an accuracy of 85.29\% whereas the local solving yielded 76.33\%.
%TODO: Write how we do it and negative things of CBR
\subsection{Using a predefined layout}
Another approach that has been discussed before by Cesarini et. al. is a definition of a structure how invoices look alike \cite{Cesarini98}. This model has to be created by a user before and can be seen as a template. The system knows on which positions relevant invoice information are due to the predefined locations from the template.
Some of the scanned invoices may contain quality issues (e.g. have been scanned with an angle) that have to be taken into account while processing the document. Counteractions, such as deskewing\footnote{Deskewing is related to the rotation of an image to a zero degree angle} the invoice document, have to be applied in a way that the template can be applied on the document.

We are not using a predefined layout that has to be manually created by the user. Instead, the application will learn from the position of keywords in previously processed invoice documents and reuse this pattern on invoices documents of the same creditor.

The major downside of the approach of Cesarini et. al. \cite{Cesarini98} is the need of a manually created template. This does not only take time and is error-prone, but also only applies on invoices of exactly the same structure. But, especially in the field of invoice documents, there are various kinds and different structured invoices. This would lead to the expectation that the user has to create a template every time an invoice of a new customer, supplier, etc. should be processed.

\subsection{Extracting information from repeated text}
Another issue to deal with invoices is to extract every position that is listed in the invoice. Typically these are multiple positions and therefore displayed in a table. A paper by Bart \& Psarker \cite{Bart10}  describe an approach that recognizes repated structures by analyzing the basic similarity between lines, the separation as well as gaps in between to find out the relevant information.

In the application presented in this thesis, a histogram is used to detect tables which contain information. This enables us to narrow the relevant words to the ones inside the table. In addition to that, keywords that either mark table header words or sum up the positions in the end of the table are filtered out.

The approach of Bart \& Psarker \cite{Bart10} is based on the assumption that there are multiple lines of positions. Although this is often the case, there are also invoices with only one position that would not be detected. Also other relevant keywords will not be detected if they are not presented in the invoice document as a table (or at least embedded in a repeated structure).
In our approach, we do not identify lines by calculating similarities or gaps. Instead, a search for table lines is made and position information are read that stand between starting and ending keywords.

%Other relevant academic work and how it differs from this work, for
%example %\citet{shannon_diff} and %\citet{blowfish}. Distinguish between
%``textual'' citation, as shown in %\citet{shannon_diff}, and
%``parenthesis'' citation %\citep{blowfish}.

\section{Results}
\label{sec1.5}
%What has been achieved in this work?
This thesis presents an application that is capable of automatic form processing and transformation of an invoice document into an electronic invoice format. The application makes use of the hOCR microformat originally presented by Thomas M. Breuel \cite{Breuel07} during the OCR process. This way the position of keywords are stored and can be reused when similar invoice documents should be processed.

A Machine Learning algorithm supports the extraction of invoice information. The relation between a position and a set of debit and credit accounts are saved. A Na{\"i}ve Bayes classificator is used to determine the most reasonable combination of credit and debit accounts for a new position.

Processed invoice documents are stored in the database and can be retrieved using a search function. All processed and saved documents are conformal with the ZugFerd standard originally published in 2014 \cite{Ferd14}.

\section{Outline}
\label{sec1.6}

%How is the thesis structured and why? 
This thesis is structured as follows: First, several electronic invoice formats are presented, explained and compared. Important criteria for the selection of a format are defined. These criteria will be applied on the formats in order to decide which format will be supported by the application.

After that, we will explain how we want to process a file to a document in the selected electronic invoice format. Chapter 3 will deal with OCR, the available systems at this time as well as a comparison between them and the selection of one of them (including the explanation why this selection has been made).
As the application should learn and improve results over time, we will also deal with machine learning techniques and choose an appropriate one. Chapter 4 will focus on this issue.

%From this point on, we have a good understanding about what we want to achieve, with which technologies and methods as well as necessary tools or frameworks for that. 
Chapter 5 will now discuss several use-cases of the application and show the architectural concept of the application. The following sections will deal with each module and explain it in-depth. The last section will discuss problems that occurred during the implementation.

%TODO: data tests?

Finally, chapter 6 will conclude about this thesis. The resulting application will be explained briefly again. Issues that are still open as well as ideas that could improve the application are listed.

\section{Acknowledgments}
\label{sec1.7}

During the implementation of the application and the creation of this document, several people helped me to achieve this presented work. I would like to thank some people in particular:

To Dr. Peter Wilke, who not only supervised my work, but also put thoughts to things that i have not considered before but were crucial for the application.

To Prof. Dr. Oliveira, who supervised my work during my stay in brasil and who gave me good input especially in the field of OCR.

To Prof. Daniel Weingaertner, who managed my stay in brazil, enrolled me in the university and organized all the necessary documents.

To Daniel Stemler whose engagement enabled me to gain access to over thousand invoice documents in order to get a reasonable amount of data to test on.

And to several other friends that helped me or supported me with advices or discussions about technologies or to clarify my understanding regarding a specific approach.